\documentclass[a4paper,11pt]{article}
%\documentclass[preprint]{aa}

%\documentclass[preprint]{aastex}

%\documentclass[journal = ancham]{achemso}
%\setkeys{acs}{useutils = true}
%\usepackage{fullpage}
\usepackage{natbib,twoopt}
\pretolerance=2000
\tolerance=6000
\hbadness=6000
%\usepackage[landscape]{geometry}
%\usepackage{pxfonts}
%\usepackage{cmbright}
%\usepackage[varg]{txfonts}
%\usepackage{mathptmx}
%\usepackage{tgtermes}
\usepackage[utf8]{inputenc}
%\usepackage{fouriernc}
%\usepackage[adobe-utopia]{mathdesign}
\usepackage[T1]{fontenc}
%\usepackage[norsk]{babel}
\usepackage{epsfig}
\usepackage{graphicx}
\usepackage{amsmath}
%\usepackage[version=3]{mhchem}
\usepackage{pstricks}
\usepackage[font=small,labelfont=bf,tableposition=below]{caption}
%\usepackage{subfig}
\usepackage{subcaption}
%\usepackage{varioref}
\usepackage{hyperref}
\usepackage{listings}
%\usepackage{sverb}
\usepackage{verbatim}
%\usepackage{microtype}
%\usepackage{enumerate}
\usepackage{enumitem}
%\usepackage{lineno}
%\usepackage{booktabs}
%\usepackage{changepage}
%\usepackage[flushleft]{threeparttable}
\usepackage{pdfpages}
\usepackage{float}
\usepackage{mathtools}
%\usepackage{etoolbox}
%\usepackage{xstring}
\usepackage{aas_macros}
\usepackage[parfill]{parskip}

\floatstyle{plaintop}
\restylefloat{table}
%\floatsetup[table]{capposition=top}

\setcounter{secnumdepth}{3}

\newcommand{\tr}{\, \text{tr}\,}
\newcommand{\diff}{\ensuremath{\; \text{d}}}
\newcommand{\diffd}{\ensuremath{\text{d}}}
\newcommand{\sgn}{\ensuremath{\; \text{sgn}}}
\newcommand{\UA}{\ensuremath{_{\uparrow}}}
\newcommand{\RA}{\ensuremath{_{\rightarrow}}}
\newcommand{\QED}{\left\{ \hfill{\textbf{QED}} \right\}}
\newcommand{\CHHO}{\text{CH\ensuremath{_2}O} }

%% The below macros turn citations into ADS clickers in dvi, pdf, html output.
%% EDP Sciences improved them in December 2012 to work also with pdflatex.
\bibpunct{(}{)}{;}{a}{}{,}    %% natbib cite format used by A&A and ApJ
\makeatletter
 \newcommandtwoopt{\citeads}[3][][]{\href{http://adsabs.harvard.edu/abs/#3}%
   {\def\hyper@linkstart##1##2{}%
    \let\hyper@linkend\@empty\citealp[#1][#2]{#3}}}    %% Rutten, 2000
 \newcommandtwoopt{\citepads}[3][][]{\href{http://adsabs.harvard.edu/abs/#3}%
   {\def\hyper@linkstart##1##2{}%
    \let\hyper@linkend\@empty\citep[#1][#2]{#3}}}      %% (Rutten 2000)
 \newcommandtwoopt{\citetads}[3][][]{\href{http://adsabs.harvard.edu/abs/#3}%
   {\def\hyper@linkstart##1##2{}%
    \let\hyper@linkend\@empty\citet[#1][#2]{#3}}}      %% Rutten (2000)
 \newcommandtwoopt{\citeyearads}[3][][]%
   {\href{http://adsabs.harvard.edu/abs/#3}%
   {\def\hyper@linkstart##1##2{}%
    \let\hyper@linkend\@empty\citeyear[#1][#2]{#3}}}   %% 2000
\makeatother

%\newcommand{\diff}{%
%    \IfEqCase{frac{\diff}{%
%        {\ensuremath{frac{\text{d}} }}%
%        {\ensuremath{\; \text{d}} }% 
%    }[\PackageError{diff}{Problem with diff}{}]%
%}%


\date{\today}
\title{Project Exam spring 2014\\ \small{Statistical methods and applications -- STK4900}}
\author{Candidate} 


\begin{document}


\onecolumn
\maketitle{}


\section*{Problem 1}

\begin{enumerate}[label=\alph*)]
    \item The concentration in parts per million of formaldehyde in 24 houses is tested against an air tightness measure in the range $[0,10]$ and whether urea formaldehyde foam insulation (UFFI) has been used. Fig.~(\ref{fig:1a-1}) shows a scatter plot of the CH$_2$O concentration distributed against the air tightness, and fig.~(\ref{fig:1a-2}) shows a box plot where the CH$_2$O concentration distribution is shown as a function of UFFI presence. 

        The plots show that there both appears to be a positive correlation between increased air tightness and CH$_2$O concentration and also a positive correlation between UFFI presence and increased CH$_2$O concentration. However, the plots do not tell whether there is a relation between the presence of UFFI and the air tightness, and if so, these covariates on the response CH$_2$O concentration are \textit{confounded}. 

        Using univariate regression, where the response \CHHO is modelled as either a function of air tightness, or as a function of UFFI presence, described generally as
        \begin{equation}
            {\rm CH_2O} = \beta_0 = \beta_1 x_1 + \beta_2 x_2 + \dots + \varepsilon
            \label{eq:linmod}
        \end{equation}
        where $\beta_0$ gives the mean concentration of \CHHO (ie.,~\textit{the intercept}), and $\beta_1$ gives the change per unit change (ie.,~\textit{the slope}) in the covariate $x_1$ which either can be the air tightness, or the binary covariate UFFI presence in this part of the problem. The $\varepsilon$ is the error. 

        The coefficients of determination, giving a measure on how large the residual sum of squares are, compared to the total sum of squares, are given for the aforementioned models in tab.~(\ref{tab:2}). A smaller residual sum of squares, gives a larger $R^2$.  This is beneficial, because the variability is then minimised.

        Model 1 has $\beta_0 = 46.12$ and $\beta_1 = 9.074$ and the Student's $t$-value is 2.253 giving a $P$-value of 0.0346, which is large, meaning the null hypothesis $H_0$ (the covariate has no effect) is \textit{not} rejected.

        Model 2 has $\beta_0 = 36.12$ and $\beta_1 = 2.830$, with a $t$-value of 5.573 giving a $P$-value of $1.33\times10^{-5}$, which is small, meaning the null hypothesis $H_0$ is rejected.

        \begin{figure}[htb]
            \centering
            \includegraphics[width=0.6\columnwidth]{../1a1-CH2O_air.pdf}
            \caption{Scatter plot showing how the CH$_2$O concentration in parts per million (ppm) distribute according to the measured air tightness in Problem 1. By visual inspection, there appear to be a positive correlation, and Pearson's correlation coefficient is 0.7651. }
            \label{fig:1a-1}
        \end{figure}
        \begin{figure}[htb]
            \centering
            \includegraphics[width=0.6\columnwidth]{../1a2-CH2O_UFFI.pdf}
            \caption{Boxplot showing the response of the CH$_2$O-concentration depending on whether a home has UFFI present (category 1) or not (category 1). The median CH$_2$O concentration is higher when UFFI is present, than without.}
            \label{fig:1a-2}
        \end{figure} 
        \begin{figure}[htb]
            \centering
            \includegraphics[width=0.6\columnwidth]{../1a3-model_crossvalR2.pdf}
            \caption{The coefficients of determination $R^2$ (blue boxes), adjusted $R_2$ (black circles) and the cross validated $R^2_{\rm cv}$ (red filled circles) plotted against model number (given in tab.~(\ref{tab:2})). The highest cross validated coefficient of determination is achieved for model 3. This model is pursued further in problem 1c). }
            \label{fig:1a-3}
        \end{figure}
    \item Including a interaction term and both covariates, gives model 4. Both covariates alone is given by model 3. Model 5 includes, in addition to an interaction term, also a quadratic term for the air tightness. See tab.~(\ref{tab:2}). 

        According to the cross validated $R^2_{\rm cv}$, model 3 is the best model, where the intercept and slopes are approximated as $\hat{\beta}_0 = 31.34$, $\hat{\beta}_{\rm AIR} = 2.855$ and $\hat{\beta}_{\rm UFFI} = 9.312$. The $P$-values for both covariates are small (of magnitudes $10^{-7}$ and $10^{-4}$, respectively), thus are they likely to have significant effect on the outcome. 

        The interaction term \texttt{AIR:UFFI}, which would be represented in a linear model as the term $\beta_{\rm AIR:UFFI} x_{\rm AIR} x_{\rm UFFI}$, had a large $P$-value and is thus insignificant in combination with the other two covariates.

        Including also a quadratic term \texttt{I(AIR$^2$)}, given as $\beta_{\rm AIR^2} x_{\rm AIR}^2$, which neither is significant ($P = 0.5078$, accepting the null hypothesis), does not improve the model and reduces the significance of the other covariates.

        \begin{table}
            \scriptsize
            \centering
            \makebox[\linewidth]{
            \begin{tabular}{l c c c c c c c}
                Model   & \texttt{UFFI}     & \texttt{AIR} & \texttt{AIR:UFFI}  & \texttt{I(AIR$^2$)} & $R^2$ & Adj. $R^2$ & $R^2_{\rm cv}$ \\
                \hline
                1       & Y &&&& 0.1874 & 0.1505 & 0.1505 \\
                2       & & Y  &&& 0.5854 & 0.5665 & 0.5665  \\
                3       & Y & Y &&  & 0.7827 & 0.7620 &  0.7620 \\
                4       & Y & Y & Y & & 0.7895 & 0.7580 &0.7580 \\
                5       & Y & Y & Y & Y & 0.7899 & 0.7457 & 0.7457 \\
                \hline
            \end{tabular}}
            \caption{Models used in problem 1, showing what covariates that are included. The three rightmost columns give the $R^2$ coefficients, where the adjusted $R^2$ coefficient is less prone to outliers, and the cross validated $R^2_{\rm cv}$. The latter penalises the inclusion of additional covariates. See fig.~(\ref{fig:1a-3}) for a plot of the coefficients of determination.}
            \label{tab:2}
        \end{table}

    \item The residuals (the difference between the observed values, and the predicted values by the linear model) for model 3 are plotted in figs.~(\ref{fig:1c-1}, \ref{fig:1c-2}). See the caption text for details. The residuals do not appear to have any systematic pattern. 

        \begin{figure}[htb]
            \centering
            \includegraphics[width=0.6\columnwidth]{../1c1-model3_residuals.pdf}
            \caption{Plot showing the distribution using model 3, where the response CH$_2$O concentration in PPM is given by the two covariates \texttt{AIR} (density) and \texttt{UFFI} (presence of formaldehyde insulation foam). Note that the residuals do not appear to have any systematic pattern, they are thus distributed homoscedastically. The presence of outliers (denoted by numbers next to the points) make the model under- and overpredict the model response compared to the outlier's values. }
            \label{fig:1c-1}
        \end{figure}
        \begin{figure}[htb]
            \centering
            \includegraphics[width=0.6\columnwidth]{../1c2-model3_stdresiduals.pdf}
            \caption{Plot showing the distribution of \textit{standardised} residulas for model 3 with two covariates. The standardised residuals are less prone to outliers, in comparision with fig.~(\ref{fig:1c-1}), where the outliers affect the predicted outcome, there is no such pattern in the current plot. }
            \label{fig:1c-2}
        \end{figure}
\end{enumerate}

\section*{Problem 2}
\begin{enumerate}[label=\alph*)]

    \item a
\end{enumerate}

\section*{Problem 3 - Wheezing}
\begin{enumerate}[label=\alph*)]
    \item  The proportion of children with wheezing to whether the mother is a smoker or non-smoker can be found as $\hat{p}_{\rm smoker} = w / n_{\rm smoker}$ and  $\hat{p}_{\rm non-smoker} = w / n_{\rm non-smoker}$, where $w$ is the number of children wheezing in the sample, and $n_i$ is the subgroup of the population with property $i$. A null hypothesis, $H_0$, that $p_{\rm smoker} = p_{\rm non-smoker}$ can be estimated using the $z$-statistic, given as
        \begin{equation}
            z = \frac{\hat{p}_{\rm smoker} - \hat{p}_{\rm non-smoker}}{se_0(\hat{p}_{\rm smoker} - \hat{p}_{\rm non-smoker} ) }
            \label{eq:z_statistic}
        \end{equation}
        where the standard error under the null hypothesis is
        \begin{equation}
            se_0 \left( \hat{p}_{\rm smoker} - \hat{p}_{\rm non-smoker} \right) = \sqrt{ \frac{\hat{p} \left( 1 - \hat{p} \right)}{n_{\rm smoker}} + \frac{\hat{p}\left( 1- \hat{p} \right)}{n_{\rm non-smoker}}  }
            \label{eq:se_0}
        \end{equation}
        where $\hat{p}$ is the combined sample proportion. The null-hypothesis is rejected for large $|z|$-values.

        The proportions were estimated using R, giving $\hat{p}_{\rm smoker} = 0.1751$ and $\hat{p}_{\rm non-smoker} = 0.1393$.

        The 95 \% confidence interval for the difference $\hat{p}_{\rm smoker} - \hat{p}_{\rm non-smoker}$ is $\hat{p}_{\rm smoker} - \hat{p}_{\rm non-smoker} \pm 1.96 \cdot se \left( \hat{p}_{\rm smoker} - \hat{p}_{\rm non-smoker} \right)$, where the standard error now is for each sample, giving the interval $0.0358 \pm 1.96 \cdot 0.0167$ or $[3.123 \times 10^{-2}, 6.857 \times 10^{-2}]$.

        The $z$-statistic was found to be $z = 2.206$, which is significant, and the null hypothesis can be rejected.

        The relative risk can be found as the ratio between an \textit{exposed} and \textit{un-exposed} population, if these are independent. Denoting $w = 0,1$ the event that a member of the population wheezes, given an $x = 0,1$ that the mother smokes, one can express $p_{\rm smoker} = P( w=1 | x=1 )$ and $p_{\rm non-smoker} = P( w=1 | x=0)$. The relative risk (RR) then is
        \begin{equation}
            RR = \frac{P\left( w=1 | x=1 \right)}{P\left( w=1 | x=0 \right)}
            \label{eq:RR}
        \end{equation}
        where an increase in RR corresponds to a larger $P(w=1 | x=1)$ and hence a greater risk of wheezing if the mother smokes.

        The odds ratio (OR) is derived from the odds, where the odds is $p/(1-p)$, the odds ratio between two $p$-s is
        \begin{equation}
            OR = \frac{p_{\rm smoking} / \left( 1-p_{\rm smoking} \right)}{p_{\rm non-smoking} / \left( 1-p_{\rm non-smoking} \right)}
            \label{eq:OR}
        \end{equation}

        In the case where the proportions are approximated as $\hat{p}_{\rm smoking} = \hat{P}(w=1 | x=1 ) = 0.1751$ and $\hat{p}_{\rm non-smoking} = \hat{P}(w=1 | x=0) = 0.1393$, the relative risk becomes $RR = 1.257$ and the odds-ratio is $OR = 1.312$ or approximately 4:3. 

        For two independent populations, the RR gives that if the mother smokes, there is a 26 \% higher probability that the child wheezes. The odds-ratio gives that the baby is more likely to have wheezing if exposed to a smoking mother. The odds ratio should be accompanied by a confidence interval, which will be obtained in the next exercise. 

    \item Using logistic regression, yielding a model on the form
        \begin{equation}
            p(x) = \frac{\exp\left[ \beta_0 + \beta_1 x \right]}{1 + \exp\left[ \beta_0 + \beta_1 x \right]}
            \label{eq:logit}
        \end{equation}

        where $\beta_0$ is associated with the baseline value, that is the reference probability where the covariate $x$ is not assumed to affect the outcome. Any changes in $x$ would be expressed as a change from the baseline. A change of one unit in $x$ can be expressed as $x' = x + \Delta_x$, the odds ratio between $p(x)$ and $p(x')$ can be found by using that the odds is 
        \begin{align*}
            \frac{p(x)}{1 - p(x)} &= \frac{\exp\left[ \beta_0 + \beta_1 x \right] / \left( 1 + \exp\left[ \beta_0 + \beta_1 x \right] \right)}{1 - \exp\left[ \beta_0 + \beta_1 x \right]/\left( 1 + \exp\left[ \beta_0 + \beta_1 x \right] \right)} \\
            &= \frac{\exp\left[ \beta_0 + \beta_1 x \right]}{1 + \exp\left[ \beta_0 + \beta_1 x \right] - \exp\left[ \beta_0 + \beta_1 x \right]} \\
            &= \exp\left[ \beta_0 + \beta_1 x \right]
        \end{align*}
        giving an odds ratio between $p(x)$ and $p(x')$
        \begin{align*}
            OR &= \frac{p(x')/\left( 1 - p(x') \right)}{p(x)/\left( 1-p(x) \right)} \\
            &= \frac{\exp\left[ \beta_0 + \beta_1 x' \right]}{\exp\left[ \beta_0 + \beta_1 x \right]} \\
            &= \exp\left[ \beta_1 \left( x' - x \right) \right] = \exp\left[ \beta_1 \left( (x + \Delta_x) - x \right) \right] \\
            &= \exp\left[ \beta_1 \Delta_x \right],
        \end{align*}

        having $\Delta_x$ as one unit increase in $x$, the odds ratio becomes $\exp[\beta_1]$. 

        The confidence interval for the odds ratio is baked into the uncertainty following the approximation of the maximum likelihood parameter $\beta_1$; $\hat{\beta_1}$. 

        Using the \texttt{glm}-argument with \texttt{family=binomial} in R, the maximum likelihood parameters $\beta_0$, $\beta_{\rm smoking}$ and $\beta_{\rm age}$ were estimated for the case where children were wheezing.

        First, a model with only the binary covariate ``\texttt{smoking}'', gave the estimates $\hat{\beta}_0 = -0.8630$ and $\hat{\beta}_{\rm smoking} = 0.2721$ which yields the odds ratio $OR = \exp[0.2721] = 1.312$, exactly the same as the OR calculated in ex.~3a). 
        
        The 95 \% confidence interval is given from the standard error $se(\hat{\beta}_{\rm smoking}) = 0.1233$. This gives an $OR$
        \begin{equation}
         OR = \exp \left[ \hat{\beta}_{\rm smoking} \pm 1.96 \cdot se\left( \hat{\beta}_{\rm smoking} \right) \right],
            \label{OR}
        \end{equation}
        or  $OR \in \left[1.030, 1.671  \right]$. Note that the lower bound is close to one. An $OR$ of one means that the covariate has \textit{no effect}. 
        
        The null hypothesis that smoking has no effect ($\beta_{\rm smoking} = 0$) is rejected if $|z| = \big| \hat{\beta}_{\rm smoking} / se\left( \hat{\beta}_{\rm smoking}  \right) \big|$ is large. Here, $z = 2.202$, yielding a slightly \textit{significant} $P$-value, meaning the null hypothesis could be valid; $P = 0.0277$. 

        A second model, including the covariate \texttt{age} as well as the binary covariate \texttt{smoking}, would need a different mean of testing the null hypothesis that the covariates have no effect. In the case with linear models, the model was said to give a good fit if the model was able to minimise the residual sum of squares. In logistic regression, the model is said to procure a good fit if it can minimise the $G = D_0 - D$ statistic, that is, minimise the difference in deviance under the null hypothesis ($D_0$) and the logistic model ($D$). The $G$-statistic is $\chi^2$ distributed and the $P$-value for the null hypothesis can then be read out when the degrees of freedom are known. It is thus necessary to have a baseline model to compare with, and the null hypothesis is that there is no effect from adding/removing covariates.

        A model with two covariates, \texttt{smoking} and \texttt{age}, yielded maximum likelihood estimates (MLEs) $\beta_{\rm smoking} = 0.2721$ and $\beta_{\rm age} = -0.1134$. The $P$-value was slightly reduced for the \texttt{smoking} covariate compared to the first model, from $P = 0.0277$ to $P= 0.0275$. The $P$-value of the MLE 

        The first model, with only one covariate, has residual deviance $D_0 = 1824$, and the model with two covariates has residual deviance $D = 1820$, giving $G = 4.417$ and $P = 0.0356$ under one degree of freedom. The second model does thus prove to be a slight improvement over the first model. It should be noted that the MLE $\beta_{\rm smoking}$ did not change substantially from one model to the other, indicating that the covariates \texttt{age} and \texttt{smoking} are \textit{not} confounded. The association with smoking is thus \textit{not} changed when taking age into account.

        In the second model, the MLEs $\beta_{\rm smoking} = 0.2721$ indicates that the binary covariate \texttt{smoking} increases the odds of a child wheezing, compared to the baseline where the mother does not smoke. Furthermore, $\beta_{\rm age} = -0.1134$ indicates that the odds of wheezing are \textit{decreased} when the age is increased. The odds of wheezing is reduced by a factor of $\exp\left[ -0.1134 x_{\rm age} \right]$ for increases in one year from the baseline 7 years, to the maximum 10 years of age. 

\end{enumerate}

%%%%%%%%%%% BIBLIOGRAPHY %%%%%%%%%%%%%%%%%
\bibliography{referanser}
\bibliographystyle{apj}
%\bibliographystyle{astroads}
%\bibliographystyle{apj_hyperref}

\clearpage
\appendix
\section{Appendix}
\label{sec:appendix}

\subsection{Problem 1a)}
\label{app:1a}

For the linear models in exercise 1a);
{\footnotesize
    \verbatiminput{../1a_models.txt}
}

\subsection{Problem 1b)}
\label{app:1b}

For the three linear models in exercise 1b);
{\footnotesize
    \verbatiminput{../1b_models.txt}
}

\subsection{Problem 3}
\subsubsection{3a)}
{\footnotesize
    \verbatiminput{../res_ex3.txt}
}


\subsubsection{3b)}
{\footnotesize
    \verbatiminput{../res_ex3b.txt}
}

Comparision of the two logistic models, one with only one covariate, and the other with two covariates (\texttt{smoking} and \texttt{age});
{\footnotesize
    \verbatiminput{../res_ex3b_anova.txt}
}


%\section{Source code}

%\lstinputlisting[language=R]{../bears.R}



\end{document}

